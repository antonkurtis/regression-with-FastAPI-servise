# Описание важных файлов и папок в репозитории:
/files - папка с загружаемыми файлами и результатами предсказания модели

/pickle - папка с pickle файлами модели, scaler и OneHotEncoder

/templates - папка с html формами для сервиса FastAPI



Kurtis_HW1 ... .ipynb - ноутбук с исследованиями и тестами

main.py - сервис FastAPI


# Работа сервиса FastAPI
## Стартовая страница сервиса:

<img width="794" alt="Снимок экрана 2022-12-04 в 12 27 54" src="https://user-images.githubusercontent.com/65371436/205483512-09216d10-8fb9-4fc5-b78f-a0108485eda5.png">

## 1) Пользователю предлагается ввести параменты одного авто для оценки:
<img width="450" alt="Снимок экрана 2022-12-02 в 15 17 28" src="https://user-images.githubusercontent.com/65371436/205483023-9b473143-4f4a-4d29-b01f-28c8072ef25e.png">

### После успешной загрузки параметров появляется сообщение: 


<img width="587" alt="Снимок экрана 2022-12-02 в 15 18 11" src="https://user-images.githubusercontent.com/65371436/205483048-7fc74f0e-f2ce-4c49-aeff-1e13f8070ba6.png">

## 2) Или .csv файл со списком афто для оценки:
<img width="341" alt="Снимок экрана 2022-12-02 в 15 18 47" src="https://user-images.githubusercontent.com/65371436/205483103-d794713c-5594-435c-aa10-3a2e9a87e9ff.png">

### После успешной загрузки выводится сообщение:

<img width="589" alt="Снимок экрана 2022-12-02 в 15 22 24" src="https://user-images.githubusercontent.com/65371436/205483128-313263a7-e6a8-415d-807b-7f3c16715bdc.png">

## 3) Внизу стартовой страницы есть 2 ссылки: на .txt файл с предсказанием цены одного авто (открывается на странице)
<img width="346" alt="Снимок экрана 2022-12-02 в 15 22 43" src="https://user-images.githubusercontent.com/65371436/205483182-d7ae8802-992b-4cf5-8a17-1c877c970870.png">
<img width="334" alt="Снимок экрана 2022-12-02 в 15 22 54" src="https://user-images.githubusercontent.com/65371436/205483191-67fa47a7-d602-4819-8e7a-a961a48f62bc.png">
<img width="338" alt="Снимок экрана 2022-12-02 в 15 25 10" src="https://user-images.githubusercontent.com/65371436/205483199-8602669a-e40e-449e-a34d-7cf4ab93ecf7.png">

## 4) Или перейти на страницу со ссылкой на скачивание .csv файла с новой колонкой предсказанных цен:
<img width="343" alt="Снимок экрана 2022-12-02 в 15 28 30" src="https://user-images.githubusercontent.com/65371436/205483310-daec6c9d-e9b1-4277-b83e-ce0749ba0d8d.png">

<img width="967" alt="Снимок экрана 2022-12-02 в 15 28 47" src="https://user-images.githubusercontent.com/65371436/205483319-2557579f-5923-4ade-aec9-f6ffa423c35d.png">

<img width="955" alt="Снимок экрана 2022-12-02 в 15 30 02" src="https://user-images.githubusercontent.com/65371436/205483328-b1f07904-3071-485c-b4df-297738f0a547.png">


## 5) Что происходит "под капотом":
- импортируется предобученная модель, OneHotEncoder и Scaler
- через FastAPI получаются и сохраняются данные от пользователя
- происходит предобработка данных, очистка, генерация фичей по аналогии с ноутбуком
- делаются предсказания и сохраняются в отдельные файлы
- пользователь получает результат, переходя по соответствующим ссылкам главной страницы сервиса

##  На этом возможности сервиса заканчиваются.


# Что было сделано в ноутбуке:
Естественно, обязательные инструкции, указанные Автором, перечислять не буду

- объемная работа с колонкой torque. Пришлось обработать множество краевых случаем средствами регулярных выражений, ибо данные были в самой разнообразной форме. Первым этапом добился корректного разделения на значение крутящего момента и значении оборотов при нем на 2 колонки
- Вторым этапом работы с уже 2-мя новыми колонками стала так же очистка данных, приведение к одним еденицам измерения (Nm). В ноутбуке подробно комментировал каждую ячейку кода.
- Из ячейки name получил брэнд авто и сделал его категориальным признаком
- Обучил OneHotEncoder на полном датасете (потому что анализ показал, что в тесте и трейне будут встречаться разные значения категориальных признаков (seats, brand))
- Были почищены аутфиты. В частности авто, которые едут 0 км на литре бензина это странно (электромобилей у нас нет), авто с пробегом > 500 000 и единственное самое мощное авто.
- на попарных графиках где то визуально заметилось лог-нормальное распределение. В итоге после нескольких экспериментов добавил в датасет лог-признаки нескольких числовых колонок

В итоге, наибольший бустинг дало добавление категориального признака brand. Очевидно, что средний мерседес стоит дороже среднего киа. А так же логарифмирование некоторых признаков.

Не вышло получить вменяемое качество модели, а особенно ее бизнесовой метрики.
Почему? Наверное потому, что модель недостаточно сложная (funfact - СatBoost на этом же датасете показал значение r2 в 0.91 против моих 0.795 практически из коробки)
Вторая причина - недостаточная работа с признаками. Возмножно нужно было нагенерировать побольше чего то осмысленного.
